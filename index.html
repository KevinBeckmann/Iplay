<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPlay Store - Tech Edition Funcional</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

        :root {
            --bg-body: #0b0c10;
            --bg-card-dark: #15161c;
            --bg-card-light: #f2f2f2;
            --accent-green: #6eea70;
            --text-white: #ffffff;
            --text-gray: #a1a1a1;
            --font-main: 'Inter', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: #08090b;
            color: var(--text-white);
            font-family: var(--font-main);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 50% 0%, rgba(20, 24, 30, 0.9) 0%, rgba(8, 9, 11, 1) 80%),
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm25 0c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm25 0c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm25 0c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7z' fill='%23000000' fill-opacity='0.05'%3E%3C/path%3E%3C/svg%3E");
            background-size: cover, 400px 400px;
            position: relative; /* Adicionado para suporte a position absolute */
        }

        /* --- Header --- */
        header {
            border-bottom: 1px solid rgba(255,255,255,0.1);
            border-top: 1px solid rgba(255,255,255,0.3);
            padding: 15px 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(192,192,192,0.1) 50%, rgba(64,64,64,0.2) 100%), rgba(8, 9, 11, 0.9);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
            transition: transform 0.3s ease; /* Adicionado para animação de retração */
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        header.hidden {
            transform: translateY(-100%); /* Esconde o header ao rolar para cima */
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        /* small toggle for mobile to retract nav buttons - REMOVED */

        /* SUBSTITUIÇÃO PARA .logo-area: Removido o círculo, logo diretamente ao lado */
        .logo-area {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            min-height: 140px; /* Aumentado para acomodar tamanhos maiores */
        }

        .logo-and-title {
            display: flex;
            align-items: center;
            gap: 10px; /* Reduzido de 20px para 10px para aproximar */
        }

        /* Removido .logo-glow e seus estilos de círculo */

        .logo-img {
            width: auto; /* Largura automática para manter proporção */
            height: 6rem; /* Dobrado de 3rem para 6rem */
            object-fit: contain; /* Ajusta sem cortar */
            display: block;
        }

        .text-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .logo-title {
            font-size: 3rem; /* Mantido */
            font-weight: 700;
            color: var(--accent-green);
            margin: 0;
            text-shadow: 0 0 10px rgba(110, 234, 112, 0.5);
        }

        .logo-subtitle {
            font-size: 0.8rem; /* Mantido */
            font-weight: 400;
            color: #ccc;
            margin-top: 2px; /* Ajustado para menos espaço */
            text-align: left;
        }

        /* Admin button top-right */
        .admin-link {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            color: #fff;
            padding: 8px 10px;
            border-radius: 999px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            backdrop-filter: blur(8px);
            z-index: 1100;
        }
        .admin-link:hover { border-color: var(--accent-green); color: var(--accent-green); }

        /* Navigation & Search */
        .controls-bar {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            width: 100%;
            margin-top: 8px;
        }

        /* Container específico para botões de navegação */
        .nav-buttons-container {
            display: flex;
            gap: 10px;
            flex-wrap: nowrap;
            justify-content: center;
            align-items: center;
            transition: opacity 0.22s ease, height 0.22s ease, margin 0.22s ease, padding 0.22s ease;
        }
        /* hidden state when collapsed on mobile - REMOVED */

        .nav-btn {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.1);
            color: #ccc;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
            font-size: 0.9rem;
            white-space: nowrap; /* Impede que o texto quebre */
        }
        .nav-btn:hover, .nav-btn.active { border-color: var(--accent-green); color: var(--accent-green); }

        .search-box {
            display: flex;
            align-items: center;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 8px 15px;
            margin-left: 10px;
        }
        .search-box input {
            background: transparent;
            border: none;
            color: #fff;
            outline: none;
            margin-left: 10px;
            width: 200px;
        }

        .btn-schedule {
            background-color: var(--accent-green);
            color: #000;
            font-weight: 700;
            padding: 8px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.85rem;
            box-shadow: 0 0 15px rgba(110, 234, 112, 0.4);
            white-space: nowrap;
        }

        /* WhatsApp Floating Button */
        .whatsapp-fab {
            position: fixed;
            right: 16px;
            bottom: 16px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #25D366;
            color: #000;
            border: none;
            box-shadow: 0 10px 20px rgba(0,0,0,0.35);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            z-index: 1100;
        }
        .whatsapp-fab:hover { filter: brightness(1.05); transform: translateY(-1px); }

        /* --- Main Layout --- */
        .layout-grid {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 30px;
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 20px;
        }

        /* Sidebar (Mini Cart) */
        .sidebar-cart {
            background-color: #1a1c20;
            border-radius: 16px;
            padding: 25px;
            height: fit-content;
            border: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: sticky;
            top: 120px;
        }

        .cart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .cart-title { font-weight: 600; font-size: 1.1rem; display: flex; align-items: center; gap: 10px; }
        .cart-count { background: var(--accent-green); color: #000; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; font-weight: bold; }

        .cart-items-list { display: flex; flex-direction: column; gap: 15px; max-height: 400px; overflow-y: auto; }

        .cart-item {
            display: flex;
            gap: 12px;
            background: rgba(255,255,255,0.03);
            padding: 10px;
            border-radius: 8px;
            align-items: center;
        }
        .cart-thumb { width: 50px; height: 50px; background: #fff; border-radius: 8px; object-fit: contain; padding: 4px; }
        .cart-info { flex: 1; }
        .cart-info h4 { font-size: 0.9rem; color: #fff; font-weight: 500; }
        .cart-info p { font-size: 0.85rem; color: var(--accent-green); margin-top: 2px; }

        .qty-controls {
            display: flex; align-items: center; gap: 8px;
            background: rgba(0,0,0,0.3); border-radius: 4px; padding: 2px 5px;
        }
        .qty-btn { background: none; border: none; color: #fff; cursor: pointer; font-size: 12px; padding: 2px 5px; }
        .btn-remove { background: none; border: none; color: #ff5555; cursor: pointer; font-size: 0.8rem; margin-left: 5px; }

        .cart-total-row {
            display: flex; justify-content: space-between; margin-top: 20px; padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1); font-weight: bold; font-size: 1.1rem;
        }

        .btn-checkout {
            width: 100%;
            background-color: var(--accent-green); color: #000; font-weight: 700; padding: 14px;
            border-radius: 8px; border: none; margin-top: 15px; cursor: pointer; text-transform: uppercase; font-size: 0.9rem; transition: 0.2s;
        }
        .btn-checkout:hover { transform: scale(1.02); box-shadow: 0 0 15px rgba(110, 234, 112, 0.3); }

        /* Promo Carousel */
        .promo-carousel {
            margin-top: 20px;
            border-radius: 16px;
            overflow: hidden;
            height: 180px;
            position: relative;
            border: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .promo-slides {
            display: flex;
            width: 600%;
            animation: slide 25s linear infinite;
        }
        .promo-slides img {
            width: 16.666%;
            height: 180px;
            object-fit: cover;
            flex-shrink: 0;
        }
        @keyframes slide {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        /* Promo Mobile */
        .promo-mobile {
            grid-column: span 2;
            margin-top: 10px;
        }
        .promo-mobile .promo-carousel {
            display: block !important;
        }

        /* Product Grid Styles */
        .section-header { margin-bottom: 20px; font-size: 1.3rem; font-weight: 600; color: #fff; display: flex; justify-content: space-between; align-items: center; }

        .products-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }

        .card {
            border-radius: 16px; padding: 20px; display: flex; flex-direction: column; justify-content: space-between;
            position: relative; transition: transform 0.2s; background-color: #1e2126; color: #fff;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .card:hover { transform: translateY(-5px); border-color: var(--accent-green); }

        .card.featured { grid-column: span 2; background-color: #e3e3e3; color: #000; }
        .card.featured .card-title { font-size: 1.4rem; }
        .card.featured .price { color: #000; }
        .card.featured .btn-add { background: #000; color: #fff; }

        .card-img { width: 100%; height: 180px; object-fit: contain; margin: 15px 0 20px 0; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.2)); }

        .card-title { font-size: 1rem; font-weight: 700; margin-bottom: 5px; }
        .card-desc { font-size: 0.85rem; opacity: 0.7; margin-bottom: 15px; }
        
        .card-footer { display: flex; justify-content: space-between; align-items: center; margin-top: auto; gap: 12px; }

        .price { font-size: 1.2rem; font-weight: 800; color: var(--accent-green); min-width: 80px; text-align: left; }

        .btn-add {
            background-color: var(--accent-green); color: #000; border: none; padding: 8px 18px; border-radius: 6px; font-size: 0.8rem;
            font-weight: 700; cursor: pointer; transition: 0.2s;
            flex-shrink: 0;
        }
        .btn-add:active { transform: scale(0.95); }

        /* Modal Checkout */
        .checkout-modal {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.9); z-index: 2000; justify-content: center; align-items: flex-start;
            overflow-y: auto; overscroll-behavior: contain; padding: 24px 20px;
        }
        .checkout-modal.active { display: flex; }

        .checkout-content {
            background: #1a1c20; border-radius: 20px; padding: 30px; max-width: 500px; width: 100%;
            border: 1px solid var(--accent-green); box-shadow: 0 0 30px rgba(110, 234, 112, 0.2);
            max-height: calc(100vh - 64px); overflow-y: auto; -webkit-overflow-scrolling: touch;
        }

        .checkout-content h2 { color: var(--accent-green); margin-bottom: 20px; text-align: center; }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 0.9rem; margin-bottom: 6px; color: #ccc; }
        .form-group input, .form-group select {
            width: 100%; padding: 10px; border: 1px solid #333; border-radius: 8px; background: #0b0c10; color: white; font-size: 1rem;
        }

        .checkout-buttons { display: flex; gap: 10px; margin-top: 20px; }
        .checkout-buttons button { flex: 1; padding: 12px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; }
        .btn-cancel { background: #333; color: #fff; }
        .btn-confirm { background: var(--accent-green); color: #000; }

        /* Pagamento - Detalhes Dinâmicos */
        .payment-details {
            margin-top: 15px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px; padding: 15px;
        }
        .payment-details h3 { font-size: 1rem; margin-bottom: 10px; color: var(--accent-green); }
        .pix-code {
            background: #0b0c10; border: 1px solid #333; border-radius: 8px; padding: 10px; font-size: 0.85rem; word-break: break-all; color: #e6e6e6;
            max-height: 140px; overflow: auto;
        }
        .pix-actions { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
        .pix-actions button, .payment-link {
            background: var(--accent-green); color: #000; border: none; padding: 10px 12px; border-radius: 8px;
            cursor: pointer; font-weight: 700; text-decoration: none; display: inline-flex; align-items: center; gap: 8px;
        }
        .payment-qr { display: flex; justify-content: center; margin-top: 12px; }
        .payment-qr img { width: 100%; max-width: 220px; height: auto; border-radius: 8px; border: 1px solid #333; }

        /* --- Responsividade --- */
        @media (max-width: 900px) {
            body { padding-bottom: 80px; } /* Adicionado para dar espaço ao botão admin */

            .layout-grid { grid-template-columns: 1fr; gap: 16px; margin: 24px auto; padding: 0 16px; }
            .sidebar-cart { display: none; }
            .sidebar-cart.mobile-active {
                display: block; position: fixed; bottom: 0; left: 0; right: 0; max-height: 70vh; overflow-y: auto; z-index: 999;
                border-top: 1px solid var(--accent-green); border-radius: 16px 16px 0 0; background: #1a1c20; padding: 20px;
            }
            .promo-carousel { display: none; }

            /* REMOVED: show toggle button and default nav hidden */

            .controls-bar { 
                flex-direction: column; 
                gap: 12px; 
                align-items: stretch;
            }
            
            /* Ajuste para botões de navegação no mobile: lado a lado com scroll se necessário */
            .nav-buttons-container {
                width: 100%;
                justify-content: flex-start; /* Alinha à esquerda */
                overflow-x: auto; /* Permite scroll horizontal */
                flex-wrap: nowrap; /* Impede quebra de linha */
                padding-bottom: 5px; /* Espaço para scrollbar se houver */
                -webkit-overflow-scrolling: touch; /* Scroll suave no iOS */
            }
            /* Oculta scrollbar */
            .nav-buttons-container::-webkit-scrollbar { display: none; }
            .nav-buttons-container { scrollbar-width: none; }
            
            .nav-btn {
                flex: 0 0 auto; /* Não deixa encolher */
                margin-left: 8px;
                font-size: 0.8rem; /* Ajustado para caber melhor */
                padding: 6px 12px; /* Reduzido */
            }

            .search-box {
                width: 100%;
                margin-left: 0;
            }
            .search-box input { width: 100%; }
            
            /* IMPORTANT: stack product cards one below the other on mobile - ALTERADO PARA 1fr 1fr */
            .products-container { grid-template-columns: 1fr 1fr; gap: 14px; }

            .card { padding: 16px; grid-column: span 1; } /* Adicionado grid-column: span 1; */
            .card.featured { grid-column: span 2; } /* Featured spans 2 columns */

            .card-img { height: 150px; }
            .btn-schedule { width: 100%; }
            .header-container { padding: 0 12px; }
            .logo-img { height: 5rem; } /* Ajustado proporcionalmente para mobile, metade do dobro (3rem -> 6rem, mas mobile era 2.5rem -> 5rem) */
            .logo-title { font-size: 2.5rem; }
            .logo-subtitle { font-size: 0.9rem; }
            .logo-and-title { gap: 8px; } /* Reduzido de 15px para 8px para aproximar ainda mais */
            /* Ajustes para aproximar categorias e reduzir altura do logo */
            .logo-area { margin-bottom: 6px; min-height: 80px; } /* Reduzido margin-bottom e min-height */
            .controls-bar { margin-top: 4px; } /* Reduzido margin-top */

            /* Mover admin button para bottom-center no mobile - ALTERADO PARA ABSOLUTE */
            .admin-link {
                position: absolute;
                top: auto;
                bottom: 20px;
                left: 50%;
                right: auto;
                transform: translateX(-50%);
            }
        }

        @media (max-width: 600px) {
            /* .controls-bar já tratado no media query de 900px */
            .products-container { grid-template-columns: 1fr 1fr; gap: 12px; }
            .card { padding: 14px; }
            .card-img { height: 140px; }
            .checkout-content { width: 95vw; padding: 20px; max-height: calc(100vh - 32px); }
            .checkout-buttons { flex-direction: column; }

            /* center card text and avoid price/button overlap by stacking */
            .card {
                text-align: center;
            }
            .card-title, .card-desc {
                text-align: center;
            }
            .card-footer {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            .price {
                text-align: center;
                min-width: 0;
            }
            .btn-add {
                width: auto;
            }

            /* REMOVED: ensure nav starts collapsed */

            .logo-title { font-size: 2.2rem; }
            .logo-subtitle { font-size: 0.8rem; }
            /* Removido: .logo-and-title { flex-direction: column; gap: 5px; } para manter lado a lado */
        }

        @media (max-width: 420px) {
            .section-header { font-size: 1.1rem; }
            .price { font-size: 1.05rem; }
            .btn-add { padding: 8px 12px; }
            .logo-title { font-size: 1.8rem; }
            .logo-subtitle { font-size: 0.7rem; }
            .logo-img { height: 3.6rem; } /* Ajustado proporcionalmente */
            .nav-btn {
                font-size: 0.75rem; /* Menor ainda */
                padding: 5px 10px; /* Ainda menor */
            }
        }
    </style>
</head>
<body>

    <!-- REMOVED: Botão Admin movido para o final -->

    <header id="header">
        <div class="header-container">
            <div class="logo-area">
                <div class="logo-and-title">
                    <!-- Logo sem círculo -->
                    <img src="imagem.logo.png" alt="iPLAY" class="logo-img">
                    <div class="text-container">
                        <h1 class="logo-title">IPLAY</h1>
                        <p class="logo-subtitle">  SOLUÇÕES APPLE</p>
                    </div>
                </div>
            </div>

            <!-- REMOVED: mobile toggle -->

            <div class="controls-bar" id="controlsBar">
                <!-- Wrapper para os botões de navegação -->
                <div class="nav-buttons-container" id="navButtons">
                    <button class="nav-btn active" onclick="filter('all', this)">Todos</button>
                    <button class="nav-btn" onclick="filter('aparelhos', this)">Aparelhos</button>
                    <button class="nav-btn" onclick="filter('carregadores', this)">Carregadores</button>
                    <button class="nav-btn" onclick="filter('fones', this)">Fones</button>
                </div>
                
                <div class="search-box">
                    <i class="fas fa-search" style="color: #888;"></i>
                    <input type="text" id="searchInput" placeholder="Buscar produto..." onkeyup="search()">
                </div>
                
                <button class="btn-schedule" onclick="toggleCartMobile()">Cart (<span id="mobileCartCount">0</span>)</button>
            </div>
        </div>
    </header>

    <div class="layout-grid">
        
        <!-- Sidebar Esquerda (Carrinho Funcional) -->
        <aside class="sidebar-cart" id="sidebarCart">
            <div class="cart-header">
                <div class="cart-title"><i class="fas fa-shopping-cart"></i> Seu Carrinho</div>
                <span class="cart-count" id="cartBadge">0</span>
            </div>

            <div id="cartContent" class="cart-items-list">
                <div style="text-align: center; color: #666; padding: 20px;">Carrinho Vazio</div>
            </div>

            <div class="cart-total-row">
                <span>Total:</span>
                <span id="cartTotalDisplay">R$ 0,00</span>
            </div>

            <button class="btn-checkout" onclick="openCheckout()" id="btnCheckout" disabled>Finalizar Compra</button>

            <!-- Card de Promoções (Desktop) -->
            <div class="promo-carousel">
                <div class="promo-slides">
                    <img src="https://images.unsplash.com/photo-1695822822491-d92cee704368?w=600&auto=format&fit=crop&q=80" alt="Promoção iPhone">
                    <img src="https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=500&q=80" alt="Promoção MacBook">
                    <img src="https://images.unsplash.com/photo-1611186871348-b1ce696e52c9?auto=format&fit=crop&w=500&q=80" alt="Promoção MacBook Pro">
                    <img src="https://images.unsplash.com/photo-1695822822491-d92cee704368?w=600&auto=format&fit=crop&q=80" alt="Promoção iPhone">
                    <img src="https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=500&q=80" alt="Promoção MacBook">
                    <img src="https://images.unsplash.com/photo-1611186871348-b1ce696e52c9?auto=format&fit=crop&w=500&q=80" alt="Promoção MacBook Pro">
                </div>
            </div>
        </aside>

        <!-- Conteúdo Principal -->
        <main>
            <div class="section-header">
                <span id="categoryTitle">Catálogo Completo</span>
            </div>
            
            <div class="products-container" id="productList"></div>
        </main>
    </div>

    <!-- Modal Checkout -->
    <div class="checkout-modal" id="checkoutModal">
        <div class="checkout-content">
            <h2>Finalizar Pedido</h2>
            <form id="checkoutForm">
                <div class="form-group">
                    <label>Nome Completo</label>
                    <input type="text" required placeholder="Seu nome">
                </div>
                <div class="form-group">
                    <label>Telefone / WhatsApp</label>
                    <input type="tel" required placeholder="(XX) 99999-9999">
                </div>
                <div class="form-group">
                    <label>Endereço de Entrega</label>
                    <input type="text" required placeholder="Rua, Número, Bairro">
                </div>
                <div class="form-group">
                    <label>Pagamento</label>
                    <select id="paymentMethod" required>
                        <option>PIX (5% OFF)</option>
                        <option>Cartão de Crédito</option>
                        <option>Cartão de Débito</option>
                        <option>Boleto</option>
                    </select>
                </div>

                <!-- Detalhes Dinâmicos de Pagamento -->
                <div id="paymentDetails" class="payment-details" style="display:none;"></div>
                
                <div style="display: flex; justify-content: space-between; margin: 20px 0; font-weight: bold; font-size: 1.2rem;">
                    <span>Total a Pagar:</span>
                    <span id="checkoutModalTotal" style="color: var(--accent-green);">R$ 0,00</span>
                </div>

                <div class="checkout-buttons">
                    <button type="button" class="btn-cancel" onclick="closeCheckout()">Cancelar</button>
                    <button type="submit" class="btn-confirm">Confirmar Pedido</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Botão flutuante WhatsApp -->
    <button class="whatsapp-fab" onclick="openWhatsApp()" title="Falar no WhatsApp">
        <i class="fa-brands fa-whatsapp"></i>
    </button>

    <!-- Botão Admin movido para o final da página -->
    <a class="admin-link" href="./adm.html" target="_blank" rel="noopener" title="Painel do Administrador">
        <i class="fa-solid fa-user-shield"></i>
        
    </a>

    <script>
        // --- CONFIG PAGAMENTO E CONTATO (CARREGA DO LOCALSTORAGE COM FALLBACK) ---
        const LS_PAY = (() => { try { return JSON.parse(localStorage.getItem('iplay.pagamento') || '{}'); } catch { return {}; } })();
        const PIX_COPIA_E_COLA = LS_PAY.pix || 'COLOQUE_AQUI_SEU_PIX_COPIA_E_COLA_OU_LINK';
        const PAGAMENTO_LINK_CREDITO = LS_PAY.credito || 'https://SEU-BANCO-OU-GATEWAY.com/link-pagamento-cartao-credito';
        const PAGAMENTO_LINK_DEBITO  = LS_PAY.debito  || 'https://SEU-BANCO-OU-GATEWAY.com/link-pagamento-cartao-debito';
        const WHATSAPP_NUMBER = (LS_PAY.whatsapp || '').replace(/\D/g, ''); // somente dígitos

        function getPixQrUrl(text) {
            return 'https://quickchart.io/qr?text=' + encodeURIComponent(text) + '&size=260&margin=2';
        }

        // --- BASE DE DADOS DE PRODUTOS (CARREGA DO LOCALSTORAGE COM FALLBACK) ---
        const DEFAULT_PRODUTOS = [
            { id: 1, nome: "iPhone 15 Pro Max", cat: "aparelhos", preco: 8299, desc: "1TB Titanium Natural", img: "https://images.unsplash.com/photo-1695822822491-d92cee704368?w=600&auto=format&fit=crop&q=80", featured: true },
            { id: 2, nome: "MacBook Pro M3", cat: "aparelhos", preco: 12599, desc: "512GB Space Black", img: "https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=500&q=80" },
            { id: 3, nome: "MacBook Pro 16\"", cat: "aparelhos", preco: 14999, desc: "1TB Silver M3 Max", img: "https://images.unsplash.com/photo-1611186871348-b1ce696e52c9?auto=format&fit=crop&w=500&q=80" },
            { id: 4, nome: "AirPods Pro 2", cat: "fones", preco: 1899, desc: "USB-C MagSafe Case", img: "https://images.unsplash.com/photo-1588156979435-379b9d802b74?auto=format&fit=crop&w=400&q=80" },
            { id: 5, nome: "Apple Watch Ultra 2", cat: "aparelhos", preco: 6299, desc: "Titanium Case 49mm", img: "https://images.unsplash.com/photo-1549439602-43ebca2327af?auto=format&fit=crop&w=400&q=80" },
            { id: 6, nome: "Carregador MagSafe", cat: "carregadores", preco: 399, desc: "Original Apple 15W", img: "https://images.unsplash.com/photo-1583863788434-e58a36330cf0?auto=format&fit=crop&w=400&q=80" },
            { id: 7, nome: "Apple Pencil 2", cat: "aparelhos", preco: 899, desc: "Magnética para iPad", img: "https://images.unsplash.com/photo-1557858310-9052820906f7?auto=format&fit=crop&w=400&q=80" },
            { id: 8, nome: "HomePod Mini", cat: "aparelhos", preco: 799, desc: "Smart Speaker White", img: "https://images.unsplash.com/photo-1596558450255-7c0b7be9d56a?auto=format&fit=crop&w=400&q=80" }
        ];
        const LS_PRODUTOS = (() => { try { return JSON.parse(localStorage.getItem('iplay.produtos') || 'null'); } catch { return null; } })();
        const produtos = Array.isArray(LS_PRODUTOS) && LS_PRODUTOS.length ? LS_PRODUTOS : DEFAULT_PRODUTOS;

        let carrinho = [];

        // --- FUNÇÕES DE RENDERIZAÇÃO ---
        function renderProdutos(lista) {
            const container = document.getElementById('productList');
            const isMobile = window.innerWidth < 900;
            const promoHTML = `
                <div class="promo-carousel">
                    <div class="promo-slides">
                        <img src="https://images.unsplash.com/photo-1695822822491-d92cee704368?w=600&auto=format&fit=crop&q=80" alt="Promoção iPhone">
                        <img src="https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=500&q=80" alt="Promoção MacBook">
                        <img src="https://images.unsplash.com/photo-1611186871348-b1ce696e52c9?auto=format&fit=crop&w=500&q=80" alt="Promoção MacBook Pro">
                        <img src="https://images.unsplash.com/photo-1695822822491-d92cee704368?w=600&auto=format&fit=crop&q=80" alt="Promoção iPhone">
                        <img src="https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=500&q=80" alt="Promoção MacBook">
                        <img src="https://images.unsplash.com/photo-1611186871348-b1ce696e52c9?auto=format&fit=crop&w=500&q=80" alt="Promoção MacBook Pro">
                    </div>
                </div>
            `;
            let html = '';
            lista.forEach((item, index) => {
                html += `
                    <div class="card ${item.featured ? 'featured' : ''} ${index === lista.length - 1 ? 'featured' : ''}">
                        <img src="${item.img}" class="card-img" alt="${item.nome}">
                        <div>
                            <h3 class="card-title">${item.nome}</h3>
                            <p class="card-desc">${item.desc}</p>
                            <div class="card-footer">
                                <span class="price">R$ ${Number(item.preco).toLocaleString('pt-BR')}</span>
                                <button class="btn-add" onclick="adicionarAoCarrinho(${item.id})">Adicionar</button>
                            </div>
                        </div>
                    </div>
                `;
                if (index === 0 && isMobile) {
                    html += `<div class="promo-mobile">${promoHTML}</div>`;
                }
            });
            container.innerHTML = html;
        }

        function renderCarrinho() {
            const container = document.getElementById('cartContent');
            const badge = document.getElementById('cartBadge');
            const mobileBadge = document.getElementById('mobileCartCount');
            const totalDisplay = document.getElementById('cartTotalDisplay');
            const btnCheckout = document.getElementById('btnCheckout');

            const totalQtd = carrinho.reduce((sum, item) => sum + item.quantidade, 0);
            const totalValor = carrinho.reduce((sum, item) => sum + (item.preco * item.quantidade), 0);

            badge.innerText = totalQtd;
            mobileBadge.innerText = totalQtd;
            totalDisplay.innerText = `R$ ${totalValor.toLocaleString('pt-BR')}`;
            
            btnCheckout.disabled = carrinho.length === 0;

            if (carrinho.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Carrinho Vazio</div>';
                return;
            }

            container.innerHTML = carrinho.map(item => `
                <div class="cart-item">
                    <img src="${item.img}" class="cart-thumb" alt="${item.nome}">
                    <div class="cart-info">
                        <h4>${item.nome}</h4>
                        <p>R$ ${(item.preco * item.quantidade).toLocaleString('pt-BR')}</p>
                    </div>
                    <div class="qty-controls">
                        <button class="qty-btn" onclick="alterarQtd(${item.id}, -1)">-</button>
                        <span style="font-size: 0.9rem; color: #fff;">${item.quantidade}</span>
                        <button class="qty-btn" onclick="alterarQtd(${item.id}, 1)">+</button>
                    </div>
                    <button class="btn-remove" onclick="removerItem(${item.id})"><i class="fas fa-trash"></i></button>
                </div>
            `).join('');
        }

        // --- LÓGICA DO CARRINHO ---
        function adicionarAoCarrinho(id) {
            const produto = produtos.find(p => p.id === id);
            if (!produto) return;
            const itemExistente = carrinho.find(item => item.id === id);

            if (itemExistente) {
                itemExistente.quantidade++;
            } else {
                carrinho.push({ ...produto, quantidade: 1 });
            }
            renderCarrinho();
        }

        function alterarQtd(id, delta) {
            const item = carrinho.find(i => i.id === id);
            if (item) {
                item.quantidade += delta;
                if (item.quantidade <= 0) removerItem(id);
                else renderCarrinho();
            }
        }

        function removerItem(id) {
            carrinho = carrinho.filter(item => item.id !== id);
            renderCarrinho();
        }

        // --- FILTROS E BUSCA ---
        function filter(categoria, el) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            if (el) el.classList.add('active');

            if (categoria === 'all') {
                document.getElementById('categoryTitle').innerText = "Catálogo Completo";
                renderProdutos(produtos);
            } else {
                const filtrados = produtos.filter(p => p.cat === categoria);
                const label = categoria === 'aparelhos' ? 'Aparelhos'
                              : categoria === 'carregadores' ? 'Carregadores'
                              : categoria === 'fones' ? 'Fones'
                              : categoria.charAt(0).toUpperCase() + categoria.slice(1);
                document.getElementById('categoryTitle').innerText = label;
                renderProdutos(filtrados);
            }
        }

        function search() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const filtrados = produtos.filter(p => (p.nome || '').toLowerCase().includes(term));
            renderProdutos(filtrados);
        }

        // --- CHECKOUT ---
        function openCheckout() {
            const totalValor = carrinho.reduce((sum, item) => sum + (item.preco * item.quantidade), 0);
            document.getElementById('checkoutModalTotal').innerText = `R$ ${totalValor.toLocaleString('pt-BR')}`;
            document.getElementById('checkoutModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            updatePaymentUI();
        }

        function closeCheckout() {
            document.getElementById('checkoutModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function updatePaymentUI() {
            const select = document.getElementById('paymentMethod');
            const details = document.getElementById('paymentDetails');
            const metodo = select.value;

            if (!metodo) { details.style.display = 'none'; details.innerHTML = ''; return; }

            if (metodo.startsWith('PIX')) {
                details.style.display = 'block';
                details.innerHTML = `
                    <h3><i class="fas fa-qrcode"></i> Pague via PIX</h3>
                    <div class="pix-code" id="pixCode">${PIX_COPIA_E_COLA}</div>
                    <div class="pix-actions">
                        <button type="button" onclick="copyPix()"><i class="fas fa-copy"></i> Copiar Código PIX</button>
                        <button type="button" onclick="openWhatsApp(true)"><i class="fa-brands fa-whatsapp"></i> Enviar pelo WhatsApp</button>
                    </div>
                    <div class="payment-qr">
                        <img src="${getPixQrUrl(PIX_COPIA_E_COLA)}" alt="QR Code PIX">
                    </div>
                    <p style="margin-top:10px; font-size:0.85rem; color:#bbb;">
                        Abra o app do seu banco, escaneie o QR ou cole o código PIX acima.
                    </p>
                `;
            } else if (metodo.startsWith('Cartão de Crédito')) {
                details.style.display = 'block';
                details.innerHTML = `
                    <h3><i class="fas fa-credit-card"></i> Pagamento com Cartão de Crédito</h3>
                    <a class="payment-link" href="${PAGAMENTO_LINK_CREDITO}" target="_blank" rel="noopener">
                        <i class="fas fa-external-link-alt"></i> Ir para Pagamento do Banco
                    </a>
                    <p style="margin-top:10px; font-size:0.85rem; color:#bbb;">
                        Você será direcionado para o link de pagamento seguro do seu banco/gateway.
                    </p>
                `;
            } else if (metodo.startsWith('Cartão de Débito')) {
                details.style.display = 'block';
                details.innerHTML = `
                    <h3><i class="fas fa-credit-card"></i> Pagamento com Cartão de Débito</h3>
                    <a class="payment-link" href="${PAGAMENTO_LINK_DEBITO}" target="_blank" rel="noopener">
                        <i class="fas fa-external-link-alt"></i> Ir para Pagamento do Banco
                    </a>
                    <p style="margin-top:10px; font-size:0.85rem; color:#bbb;">
                        Você será direcionado para o link de pagamento seguro do seu banco/gateway.
                    </p>
                `;
            } else if (metodo.startsWith('Boleto')) {
                details.style.display = 'block';
                details.innerHTML = `
                    <h3><i class="fas fa-file-invoice"></i> Boleto</h3>
                    <p style="font-size:0.95rem;">
                        Boleto será gerado após confirmação. (Configure aqui o seu gerador/URL de boleto)
                    </p>
                `;
            } else {
                details.style.display = 'none';
                details.innerHTML = '';
            }
        }

        function copyPix() {
            const code = PIX_COPIA_E_COLA;
            navigator.clipboard.writeText(code).then(() => {
                alert('Código PIX copiado para a área de transferência!');
            }).catch(() => {
                alert('Não foi possível copiar. Selecione e copie manualmente.');
            });
        }

        // WhatsApp contact
        function buildWhatsAppMessage(includePix = false) {
            const items = carrinho.map(i => `• ${i.quantidade}x ${i.nome} — R$ ${(i.preco * i.quantidade).toLocaleString('pt-BR')}`).join('\n');
            const total = carrinho.reduce((s, i) => s + i.preco * i.quantidade, 0);
            let msg = 'Olá! Tenho interesse nos seguintes itens:\n\n' + (items || 'Sem itens no carrinho.') + '\n\nTotal: R$ ' + total.toLocaleString('pt-BR');
            if (includePix && PIX_COPIA_E_COLA) {
                msg += '\n\nCódigo PIX (copia e cola):\n' + PIX_COPIA_E_COLA;
            }
            msg += '\n\nEnviado via iPlay Store.';
            return msg;
        }

        function openWhatsApp(includePix = false) {
            const number = WHATSAPP_NUMBER;
            if (!number) {
                alert('Número de WhatsApp não configurado. Abra o painel do administrador e cadastre o número.');
                return;
            }
            const msg = buildWhatsAppMessage(includePix);
            const url = 'https://wa.me/' + number + '?text=' + encodeURIComponent(msg);
            window.open(url, '_blank', 'noopener');
        }

        // Fecha o modal ao clicar fora da caixa (overlay)
        document.getElementById('checkoutModal').addEventListener('click', (e) => {
            if (e.target.id === 'checkoutModal') closeCheckout();
        });

        document.getElementById('paymentMethod').addEventListener('change', updatePaymentUI);

        document.getElementById('checkoutForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const metodo = document.getElementById('paymentMethod').value;

            if (metodo.startsWith('PIX')) {
                alert('Pedido gerado! Pague via PIX usando o QR ou o código exibido.');
            } else if (metodo.startsWith('Cartão de Crédito')) {
                window.open(PAGAMENTO_LINK_CREDITO, '_blank', 'noopener');
                alert('Redirecionamos você para o pagamento com cartão de crédito.');
            } else if (metodo.startsWith('Cartão de Débito')) {
                window.open(PAGAMENTO_LINK_DEBITO, '_blank', 'noopener');
                alert('Redirecionamos você para o pagamento com cartão de débito.');
            } else {
                alert('Pedido gerado! Siga as instruções do método selecionado.');
            }

            carrinho = [];
            renderCarrinho();
            closeCheckout();
        });

        // Mobile Cart Toggle (correção do ID)
        function toggleCartMobile() {
            const sidebar = document.getElementById('sidebarCart');
            sidebar.classList.toggle('mobile-active');
        }

        // REMOVED: NAV toggle functions and event listeners

        // --- Header Retrátil ---
        let lastScrollTop = 0;
        const header = document.getElementById('header');

        window.addEventListener('scroll', () => {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            if (scrollTop > lastScrollTop) {
                // Scroll para baixo - esconde header
                header.classList.add('hidden');
            } else {
                // Scroll para cima - mostra header
                header.classList.remove('hidden');
            }
            lastScrollTop = scrollTop <= 0 ? 0 : scrollTop; // Para evitar valores negativos
        });

        // Init
        renderProdutos(produtos);
    </script>
</body>
</html>
